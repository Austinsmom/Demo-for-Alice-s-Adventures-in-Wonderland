<!DOCTYPE HTML>
<html lang="en-US">
<head>
  <title>Alice in Wonderland</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="css/style.css" media="all" />
</head>
<body>
  
  <div class="wrapper">
    
    <div id="trans" class="hidden"></div> 
    
    <div id="scene1">
      <div class="content">
          <h1>
            <span>Alice in Wonderland</span>
          </h1>
          
          <p>Alice was beginning to get very tired of sitting by her sister on the
          bank, and of having nothing to do: once or twice she had peeped into the
          book her sister was reading, but it had no pictures or conversations in
          it, 'and what is the use of a book,' thought Alice 'without pictures or
          conversation?' <br /><br />So she was considering in her own mind whether the pleasure
          of making a daisy-chain would be worth the trouble of getting up and
          picking the daisies, when suddenly a White Rabbit with pink eyes ran
          close by her.<br /><br />In another moment down went Alice after it, never once considering how
          in the world she was to get out again.<br /><br />The rabbit-hole went straight on like a tunnel for some way, and then
          dipped suddenly down, so suddenly that Alice had not a moment to think
          about stopping herself before she found herself falling down a very deep
          well.</p>
      </div>
      
      <script type="text/javascript">

        var p = document.querySelector('#scene1 p:first-of-type')
        var maxHeight = document.querySelector('#scene1').offsetHeight
        var offsetMultiplier = 1.5  // TODO make multiplier factor of scroll distance from container height. Short screens need multiplier < 1.

        window.onscroll = function(e){
            var newMargin = window.scrollY * offsetMultiplier;
            var oldMargin = parseInt(p.style.marginTop, 10) | 0
            var usedHeight = p.offsetHeight + p.offsetTop + (newMargin - oldMargin)

            var min = 0
            var max = min + window.innerHeight
            var current = window.innerHeight + window.scrollY
            var viewport = {
              start: window.scrollY,
              end: window.innerHeight + window.scrollY
            }
            // console.log(min, max, viewport.start, viewport.end)

            if (usedHeight < maxHeight) {
              p.style.marginTop = newMargin + "px"
              // document.body.classList.remove('scene1-end')
            }
            else{
              // document.body.classList.add('scene1-end')
            }
        }

        </script>
      
    </div><!-- end #scene1 -->
    
    <div id="scene3">
      
      <div class="decoration">
          <div class="alice-shape falling1"></div>
          <div class="alice-shape falling2"></div>
          <div class="alice-shape falling3"></div>
      </div>
      
      <div class="content">
        
        <!-- alice sitting on mushroom -->
        <div class="act1">
          <div class="alice-shape"></div>
        </div>
        
        <!-- caterpillar night act -->
        <div class="act2">

          <div class="caterpillar-shape light"></div>
          <div class="caterpillar-shape dark"></div>
          
          <div class="shadow shadow1"></div>
          <div class="shadow shadow2"></div>
          <div class="shadow shadow3"></div>
          <div class="shadow shadow4"></div>
          <div class="shadow shadow5"></div>
          
        </div>

        <!-- caterpillar day act -->
        <div class="act3">
          <div class="caterpillar-shape"></div>
        </div>
        
      </div>
    </div>
  
    <div id="scene2_1">
      <div class="overlay"></div>
    
      <div class="content">
        
        <div class="cat-shape1"></div>
        
        <p>
          Alice was beginning to get very tired of sitting by her sister on the
          bank, and of having nothing to do: once or twice she had peeped into the
          book her sister was reading, but it had no pictures or conversations in
          it, 'and what is the use of a book,' thought Alice 'without pictures or
          conversation?'
          
          <br /><br />
          Alice was beginning to get very tired of sitting by her sister on the
          bank, and of having nothing to do: once or twice she had peeped into the
          book her sister was reading, but it had no pictures or conversations in
          it, 'and what is the use of a book,' thought Alice 'without pictures or
          conversation?'
        </p>
        
        <div class="cat-shape2"></div>
        
        <p>
          Alice was beginning to get very tired of sitting by her sister on the
          bank, and of having nothing to do: once or twice she had peeped into the
          book her sister was reading, but it had no pictures or conversations in
          it, 'and what is the use of a book,' thought Alice 'without pictures or
          conversation?'
          
          <br /><br />
          Alice was beginning to get very tired of sitting by her sister on the
          bank, and of having nothing to do: once or twice she had peeped into the
          book her sister was reading, but it had no pictures or conversations in
          it, 'and what is the use of a book,' thought Alice 'without pictures or
          conversation?'
        </p>
        
        <br /><br /><br /><br />
        
        <div class="cat-shape3"></div>
        <p>
          Alice was beginning to get very tired of sitting by her sister on the
          bank, and of having nothing to do: once or twice she had peeped into the
          book her sister was reading, but it had no pictures or conversations in
          it, 'and what is the use of a book,' thought Alice 'without pictures or
          conversation?'
        </p>
        
        <br /><br /><br /><br />
        
        <div class="cat-shape4"></div>
        
        <p>
          Alice was beginning to get very tired of sitting by her sister on the
          bank, and of having nothing to do: once or twice she had peeped into the
          book her sister was reading, but it had no pictures or conversations in
          it, 'and what is the use of a book,' thought Alice 'without pictures or
          conversation?'
          
          Alice was beginning to get very tired of sitting by her sister on the
          bank, and of having nothing to do: once or twice she had peeped into the
          book her sister was reading, but it had no pictures or conversations in
          it, 'and what is the use of a book,' thought Alice 'without pictures or
          conversation?'
        </p>

      </div>
    </div><!-- end #scene2_1 -->
    
    <div id="scene2_2">
      
      <div class="content">
        <div class="act act1">
          
          <div class="cat-shape5"></div>
          
          <p>
            Alice was beginning to get very tired of sitting by her sister on the
            bank, and of having nothing to do: once or twice she had peeped into the
            book her sister was reading, but it had no pictures or conversations in
            it, 'and what is the use of a book,' thought Alice 'without pictures or
            conversation?'
          </p>
        </div>

        <div class="act act2">
          <div class="cat-shape cat-shape-walking"></div>
          
          <div class="content-wrapper">
            <p>
              Alice was beginning to get very tired of sitting by her sister on the
              bank, and of having nothing to do: once or twice she had peeped into the
              book her sister was reading, but it had no pictures or conversations in
              it, 'and what is the use of a book,' thought Alice 'without pictures or
              conversation?'
            </p>
          </div>
        </div>
        <div class="act act3">
          <div class="alice-shape"></div>
          
          <div class="content-wrapper">
            
            <!-- <p> content will be collected into a named flow and rendered in elements with class="region"-->
            <p>Alice was beginning to get very tired of sitting by her sister on the
            bank, and of having nothing to do: once or twice she had peeped into the
            book her sister was reading</p>
            
            <p>
              Alice was beginning to get very tired of sitting by her sister on the
              bank, and of having nothing to do: once or twice she had peeped into the
              book her sister was reading, but it had no pictures or conversations in
              it, 'and what is the use of a book,' thought Alice 'without pictures or
              conversation?'
            </p>
            
            <div class="region part1"></div>
            <div class="cat-paws-shape"></div>
            <div class="region part2"></div>
            
          </div>
          
        </div>
        <div class="act act4">
          
          <div class="shade shade1"></div>
          <div class="shade shade2"></div>
          
          <div class="alice-shape"></div>
          
          <div class="content-wrapper">
            <p>
              Alice was beginning to get very tired of sitting by her sister on the
              bank, and of having nothing to do: once or twice she had peeped into the
              book her sister was reading, but it had no pictures or conversations in
              it, 'and what is the use of a book,' thought Alice 'without pictures or
              conversation?'
            </p>
          </div>
          
        </div>                                         
          
        <div class="act act5">
          <div class="alice-shape"></div>
        </div>
        
        <div class="act act6">
          
          <div class="content-wrapper">
            
            <div class="cat-shape"></div>
            
            <p>
              Alice was beginning to get very tired of sitting by her sister on the
              bank, and of having nothing to do: once or twice she had peeped into the
              book her sister was reading, but it had no pictures or conversations in
              it, 'and what is the use of a book,' thought Alice 'without pictures or
              conversation?'
            </p>
            <p>
              Alice was beginning to get very tired of sitting by her sister on the
              bank, and of having nothing to do: once or twice she had peeped into the
              book her sister was reading, but it had no pictures or conversations in
              it, 'and what is the use of a book,' thought Alice 'without pictures or
              conversation?'
            </p>
            <p>
              Alice was beginning to get very tired of sitting by her sister on the
              bank, and of having nothing to do: once or twice she had peeped into the
              book her sister was reading, but it had no pictures or conversations in
              it, 'and what is the use of a book,' thought Alice 'without pictures or
              conversation?'
            </p>
            
            <div class="region" id="region1"></div>
            <div class="region" id="region2"></div>
            
          </div>
          
        </div>
      </div>

      <script>

      /* 
        Listen to scroll and offset scene2_2 horizontally while in the viewport. 
        #scene2_2 container will be pinned at the top of the viewport with 'position:fixed'.
      */
      (function(){

        // placeholder element to simulate height of container while fixed; keeps v scroll working.
        var fauxHeight = null
        var container = document.querySelector('#scene2_2')
        var styles = window.getComputedStyle(container, null)
        var marginLeft = parseInt(styles.marginLeft, 10) 
        var cache = {
          offsetTop: container.offsetTop,
          position: container.style.position,
          maxScroll: container.offsetWidth + container.offsetTop - window.innerWidth,
          vOffsetTrigger: container.offsetWidth / 3,
          vOffset: window.innerHeight - container.offsetHeight
        } 
        
        function listen(e){
          
          // pin the scene only when it reaces the top of the viewport
          if (window.scrollY >= cache.offsetTop){
            
            // jump out if placeholder was already created
            if (fauxHeight)
              return;

            /* 
            fauxHeight simulates the height of the container while it is fixed, 
            in order to keep scrolling working. Using the container's width for 
            fauxHeight because we translate vertical scroll into 
            horizontal offset. 
            */
            fauxHeight = document.createElement('div')
            fauxHeight.style.height = container.offsetWidth - window.innerWidth + window.innerHeight + 'px'
            container.parentNode.insertBefore(fauxHeight, container)
            container.style.position = 'fixed'
            container.style.top = 0
            
            window.addEventListener('scroll', scrollHorizontally)
          } else {
            
            if (!fauxHeight)
              return;

            fauxHeight.parentNode.removeChild(fauxHeight)
            fauxHeight = null
            container.style.position = cache.position
            container.style.left = 0

            window.removeEventListener('scroll', scrollHorizontally)
          }
        }
        
        function scrollHorizontally(){
          
          if (window.scrollY >= cache.maxScroll)
            return;
            
          var amount = window.scrollY - cache.offsetTop
          container.style.left = -1 * amount + 'px'

          // vary the Y offset of the scene
          if (amount > cache.vOffsetTrigger){
            var delta = amount - cache.vOffsetTrigger
            var left = container.offsetWidth - cache.vOffsetTrigger
            var off = cache.vOffset / left
            container.style.top = delta * off + "px"
          }
        }
        
        window.addEventListener('scroll', listen)
        
      })()
        
      </script>
    </div><!-- end #scene2_2 -->
  
  </div><!-- end .wrapper -->
</body>
</html>