<!DOCTYPE HTML>
<html lang="en-US">
<head>
  <title>Alice in Wonderland</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="css/style.css" media="all" />
</head>
<body>
  
  <div class="wrapper">
    <div id="scene1">
      <div class="overlay"></div>
    
      <div class="content">
          <p>Alice was beginning to get very tired of sitting by her sister on the
          bank, and of having nothing to do: once or twice she had peeped into the
          book her sister was reading, but it had no pictures or conversations in
          it, 'and what is the use of a book,' thought Alice 'without pictures or
          conversation?' <br /><br />So she was considering in her own mind (as well as she could, for the
          hot day made her feel very sleepy and stupid), whether the pleasure
          of making a daisy-chain would be worth the trouble of getting up and
          picking the daisies, when suddenly a White Rabbit with pink eyes ran
          close by her.<br /><br />In another moment down went Alice after it, never once considering how
          in the world she was to get out again.<br /><br />The rabbit-hole went straight on like a tunnel for some way, and then
          dipped suddenly down, so suddenly that Alice had not a moment to think
          about stopping herself before she found herself falling down a very deep
          well.</p>
      </div>
      <script type="text/javascript">

      var p = document.querySelector('#scene1 p:first-child')
      var maxHeight = document.querySelector('#scene1').offsetHeight
      var offsetMultiplier = 1.5  // TODO make multiplier factor of scroll distance from container height. Short screens need multiplier < 1.

      window.onscroll = function(e){
          var newMargin = window.scrollY * offsetMultiplier;
          var oldMargin = parseInt(p.style.marginTop, 10) | 0
          var usedHeight = p.offsetHeight + p.offsetTop + (newMargin - oldMargin)

          var min = 0
          var max = min + window.innerHeight
          var current = window.innerHeight + window.scrollY
          var viewport = {
            start: window.scrollY,
            end: window.innerHeight + window.scrollY
          }
          // console.log(min, max, viewport.start, viewport.end)
        
          if (usedHeight < maxHeight) {
            p.style.marginTop = newMargin + "px"
            // document.body.classList.remove('scene1-end')
          }
          else{
            // document.body.classList.add('scene1-end')
          }
      }
    
      </script>
    </div> 
  
    <div id="scene2_1">
      <div class="overlay"></div>
    
      <div class="content">
      
        <p>
        Alice was beginning to get very tired of sitting by her sister on the
        bank, and of having nothing to do: once or twice she had peeped into the
        book her sister was reading, but it had no pictures or conversations in
        it, 'and what is the use of a book,' thought Alice 'without pictures or
        conversation?'
        Alice was beginning to get very tired of sitting by her sister on the
                bank, and of having nothing to do: once or twice she had peeped into the
                book her sister was reading, but it had no pictures or conversations in
                it, 'and what is the use of a book,' thought Alice 'without pictures or
                conversation?'
                Alice was beginning to get very tired of sitting by her sister on the
                bank, and of having nothing to do: once or twice she had peeped into the
                book her sister was reading, but it had no pictures or conversations in
                it, 'and what is the use of a book,' thought Alice 'without pictures or
                conversation?'
                Alice was beginning to get very tired of sitting by her sister on the
                bank, and of having nothing to do: once or twice she had peeped into the
                book her sister was reading, but it had no pictures or conversations in
                it, 'and what is the use of a book,' thought Alice 'without pictures or
                conversation?'
                Alice was beginning to get very tired of sitting by her sister on the
                bank, and of having nothing to do: once or twice she had peeped into the
                book her sister was reading, but it had no pictures or conversations in
                it, 'and what is the use of a book,' thought Alice 'without pictures or
                conversation?'
                Alice was beginning to get very tired of sitting by her sister on the
                bank, and of having nothing to do: once or twice she had peeped into the
                book her sister was reading, but it had no pictures or conversations in
                it, 'and what is the use of a book,' thought Alice 'without pictures or
                conversation?'
                Alice was beginning to get very tired of sitting by her sister on the
                bank, and of having nothing to do: once or twice she had peeped into the
                book her sister was reading, but it had no pictures or conversations in
                it, 'and what is the use of a book,' thought Alice 'without pictures or
                conversation?'
                Alice was beginning to get very tired of sitting by her sister on the
                bank, and of having nothing to do: once or twice she had peeped into the
                book her sister was reading, but it had no pictures or conversations in
                it, 'and what is the use of a book,' thought Alice 'without pictures or
                conversation?'Alice was beginning to get very tired of sitting by her sister on the
                bank, and of having nothing to do: once or twice she had peeped into the
                book her sister was reading, but it had no pictures or conversations in
                it, 'and what is the use of a book,' thought Alice 'without pictures or
                conversation?'
                Alice was beginning to get very tired of sitting by her sister on the
                bank, and of having nothing to do: once or twice she had peeped into the
                book her sister was reading, but it had no pictures or conversations in
                it, 'and what is the use of a book,' thought Alice 'without pictures or
                conversation?'
                Alice was beginning to get very tired of sitting by her sister on the
                bank, and of having nothing to do: once or twice she had peeped into the
                book her sister was reading, but it had no pictures or conversations in
                it, 'and what is the use of a book,' thought Alice 'without pictures or
                conversation?'
                Alice was beginning to get very tired of sitting by her sister on the
                bank, and of having nothing to do: once or twice she had peeped into the
                book her sister was reading, but it had no pictures or conversations in
                it, 'and what is the use of a book,' thought Alice 'without pictures or
                conversation?'
                Alice was beginning to get very tired of sitting by her sister on the
                bank, and of having nothing to do: once or twice she had peeped into the
                book her sister was reading, but it had no pictures or conversations in
                it, 'and what is the use of a book,' thought Alice 'without pictures or
                conversation?'
                Alice was beginning to get very tired of sitting by her sister on the
                bank, and of having nothing to do: once or twice she had peeped into the
                book her sister was reading, but it had no pictures or conversations in
                it, 'and what is the use of a book,' thought Alice 'without pictures or
                conversation?'
                Alice was beginning to get very tired of sitting by her sister on the
                bank, and of having nothing to do: once or twice she had peeped into the
                book her sister was reading, but it had no pictures or conversations in
                it, 'and what is the use of a book,' thought Alice 'without pictures or
                conversation?'
                Alice was beginning to get very tired of sitting by her sister on the
                bank, and of having nothing to do: once or twice she had peeped into the
                book her sister was reading, but it had no pictures or conversations in
                it, 'and what is the use of a book,' thought Alice 'without pictures or
                conversation?'
                Alice was beginning to get very tired of sitting by her sister on the
                bank, and of having nothing to do: once or twice she had peeped into the
                book her sister was reading, but it had no pictures or conversations in
                it, 'and what is the use of a book,' thought Alice 'without pictures or
                conversation?'
                Alice was beginning to get very tired of sitting by her sister on the
                bank, and of having nothing to do: once or twice she had peeped into the
                book her sister was reading, but it had no pictures or conversations in
                it, 'and what is the use of a book,' thought Alice 'without pictures or
                conversation?'
                Alice was beginning to get very tired of sitting by her sister on the
                bank, and of having nothing to do: once or twice she had peeped into the
                book her sister was reading, but it had no pictures or conversations in
                it, 'and what is the use of a book,' thought Alice 'without pictures or
                conversation?'
        </p>
        
      </div>
    </div><!-- end #scene2_1 -->
    
    <div id="scene2_2">
      <div class="content">
        <p>
          Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
        </p>
      </div>
      <script>
      
      (function(){
        var container = document.querySelector('#scene2_2')

        // TODO: remove margin offset, make left-aligned design
        var styles = window.getComputedStyle(container, null)
        var marginLeft = parseInt(styles.marginLeft, 10)
        
        var fauxHeight = null
        var cache = {
          offsetTop: container.offsetTop,
          position: container.style.position,
          maxScroll: container.offsetWidth + container.offsetTop - window.innerWidth + marginLeft
        }
        
        function listen(e){

          if (window.scrollY >= cache.offsetTop){

            if (fauxHeight)
              return;

            /* 
            fauxHeight simulates the height of the container while it is fixed, 
            in order to keep scrolling working. Using the container's width for 
            fauxHeight because we want to translate vertical scroll into 
            horizontal offsets. 
            */
            
            fauxHeight = document.createElement('div')
            fauxHeight.style.height = container.offsetWidth + 'px'
            container.parentNode.insertBefore(fauxHeight, container)
            container.style.position = 'fixed'
            container.style.top = 0
            
            window.addEventListener('scroll', scrollHorizontally)
          } else {
            
            if (!fauxHeight)
              return;

            fauxHeight.parentNode.removeChild(fauxHeight)
            fauxHeight = null
            container.style.position = cache.position
            container.style.left = 0

            window.removeEventListener('scroll', scrollHorizontally)
          }
        }
        
        function scrollHorizontally(){
          console.log(window.scrollY) 
          
          if (window.scrollY > cache.maxScroll)
            return;

          var amount = window.scrollY - cache.offsetTop
          container.style.left = -1 * amount + 'px'
        }
        
        window.addEventListener('scroll', listen)
        
      })()
        
      </script>
    </div><!-- end #scene2_2 -->
  
  </div><!-- end .wrapper -->
  
</body>
</html>